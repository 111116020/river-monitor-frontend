<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>River Monitoring Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px; /* Add some padding around the card */
        }
        .full-screen-card {
            max-width: 900px; /* Max width for large screens */
            width: 90%; /* Occupy 90% of the container width */
            min-height: 70vh; /* Occupy 70% of viewport height */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .card-title-level {
            font-size: 4rem; /* Very large font for water level */
            font-weight: bold;
        }
        .status-badge-large {
            font-size: 1.5rem;
            padding: .5em 1em;
        }
        .graph-placeholder {
            min-height: 250px; /* Larger area for the graph */
            background-color: #e9ecef;
            border-radius: .3rem;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
            color: #6c757d;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
        <div class="container-fluid">
            <a class="navbar-brand fs-4" href="#">River Water-Level Monitoring</a>
        </div>
    </nav>

    <div class="main-content">
        <div class="card text-center full-screen-card border-success" id="riverCard">
            <div class="card-header bg-success text-white py-4">
                <h2 id="riverNameTitle" class="mb-0">Unknown River</h2>
                <span class="badge bg-light text-success status-badge-large mt-2">Normal Level</span>
            </div>
            <div class="card-body d-flex flex-column justify-content-center align-items-center">
                <p class="card-text text-muted mb-2">Current Water Level</p>
                <h1 class="card-title-level text-success mb-3"><span id="waterLevel"></span> m</h1>

                <img id="realtimeImage" style="object-fit: contain" class="w-100 mt-4">


                <div class="row w-100 mt-4">
                    <div class="col-md-6">
                        <p class="mb-1"><strong>Alert Threshold:</strong> <span id="alertThreshold"></span> m</p>
                    </div>
                    <div class="col-md-6">
                        <p class="mb-1"><strong>Flood Threshold:</strong> <span id="floodThreshold"></span> m</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let alertThreshold = 3.5;
        let floodThreshold = 4.0;

        (() => {

            document.getElementById('alertThreshold').textContent = alertThreshold;
            document.getElementById('floodThreshold').textContent = floodThreshold;

            const card = document.getElementById('riverCard');
            const levelElement = document.getElementById('waterLevel');
            const statusBadge = card.querySelector('.status-badge-large');
            const cardHeader = card.querySelector('.card-header');
            const realtimeImage = document.getElementById("realtimeImage");
            const riverNameTitle = document.getElementById("riverNameTitle");
                
            function updateRiverData() {
                fetch("/api/retrieve", {
                    "method": "POST",
                    "headers": {
                        "Content-Type": "application/json",
                    },
                    "body": JSON.stringify({})
                }).then(resp => resp.json()).then(resp => {
                    currentLevel = resp[0]["est_level"];

                    riverNameTitle.textContent = resp[0]["river_name"];
                    levelElement.textContent = currentLevel.toFixed(2);
                    realtimeImage.setAttribute("src", `/api/image/${resp[0]["timestamp"]}`);

                    // Update status and colors
                    card.classList.remove('border-success', 'border-warning', 'border-danger');
                    cardHeader.classList.remove('bg-success', 'bg-warning', 'bg-danger', 'text-white', 'text-dark');
                    levelElement.parentElement.remove('text-success', 'text-warning', 'text-danger');
                    statusBadge.classList.remove('bg-light', 'text-success', 'text-warning', 'text-danger');
                    statusBadge.classList.add('bg-light'); // Always light background for badge text

                    if (currentLevel >= floodThreshold) {
                        statusBadge.textContent = 'Flood Level';
                        card.classList.add('border-danger');
                        cardHeader.classList.add('bg-danger', 'text-white');
                        levelElement.parentElement.classList.add('text-danger');
                        statusBadge.classList.add('text-danger');
                    } else if (currentLevel >= alertThreshold) {
                        statusBadge.textContent = 'Alert Level';
                        card.classList.add('border-warning');
                        cardHeader.classList.add('bg-warning', 'text-dark');
                        levelElement.parentElement.classList.add('text-warning');
                        statusBadge.classList.add('text-warning');
                    } else {
                        statusBadge.textContent = 'Normal Level';
                        card.classList.add('border-success');
                        cardHeader.classList.add('bg-success', 'text-white');
                        levelElement.parentElement.classList.add('text-success');
                        statusBadge.classList.add('text-success');
                    }
                });
            }

            updateRiverData(); // Initial load
            setInterval(() => updateRiverData(), 10_000); // Update every 10 seconds
        })();
    </script>
</body>
</html>